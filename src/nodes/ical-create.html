<script type="text/javascript">

    RED.nodes.registerType('ical-create', {
        category: 'ical',
        defaults: {
            confignode: {
                value: "",
                type: "ical-config",
                required: false
            },
            event: {},
            eventtype: {},
            calendar: {},
            calendartype: {},
        },
        inputs: 1,
        outputs: 1,
        color: '#DEBD5C',
        label: function () {
            if (this.name) {
                return this.name;
            } else if (this.confignode.name) {
                return this.confignode.name;
            }

            return 'create events';
        },
        icon: "font-awesome/fa-calendar",
        paletteLabel: 'create',
        oneditprepare: function () {

            $('#node-input-confignode').change(function () {
                var value = $('#node-input-confignode').val();
                $.post(`icalconfig`, { id: value }, function (icalconfig) {
                    if (icalconfig.type !== 'caldav') {
                        $('#event-tip').show();
                        $('#node-input-event').parent().hide();
                    } else {
                        $('#event-tip').hide();
                        $('#node-input-event').parent().show();
                    }
                });
            });

            $("#node-input-event").typedInput({
                typeField: "#node-input-eventtype",
                types: ["json", "msg"]
            });
            $("#node-input-calendar").typedInput({
                typeField: "#node-input-calendartype",
                types: ["str", "msg"]
            });
        }
    })
</script>

<script type="text/html" id="icalUpcoming-template" data-template-name="ical-create">
    <style>
        .event {
            display: flex;
        }
    
        .event .red-ui-typedInput-container {
            flex: 1
        }
    
        .event span {
            flex: 1
        }
    
        .event label {
            min-width: 140px;
            align-self: center;
        }
    
        .padding-top {
            padding-top: 10px;
        }
    </style>
    
    <div class="form-row event">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span>Name</span></label>
        <input type="text" id="node-input-name">
    </div>
    <hr />    
    <div class="form-row event">
        <label for="node-input-confignode"><i class="fa fa-globe"></i> <span>Calendar config</span></label>
        <input type="text" id="node-input-confignode">
        <hr/>
    </div>
    <div class="form-row event padding-top">
        <label for="node-input-calendar">
            <i class="fa fa-calendar"></i>
            <span>Calendar</span>
        </label>
        <input type="text" id="node-input-calendar" placeholder="">
        <input type="hidden" id="node-input-calendartype" placeholder="">
    </div>
    <div class="form-row event padding-top">
        <label for="node-input-event">
            <i class="fa fa-calendar"></i>
            <span>Eventdata</span>
        </label>
        <input type="text" id="node-input-event" placeholder="">
        <input type="hidden" id="node-input-eventtype" placeholder="">
    </div>
    
    <div class="form-tips" id="event-tip" style="margin-bottom: 10px">
        <i class="fa fa-exclamation"></i>
        <b>HINT:</b> create Events is currently only available for calDav server
    </div>
    
</script>

<script type="text/html" data-help-name="ical-create">
    <div class="form-row">
        <a href="https://naimo84.github.io/kalender-events/guide/upcoming.html">
            <img src="https://img.shields.io/badge/doku-naimo84.github.io-0078D6?style=for-the-badge&logo=github&logoColor=white"/>
        </a>
    </div>
    <div class="form-row">
        <span>for Dateformat options have a look at </span>
        <a href="https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat" target="_blank">
            DateTimeFormat
        </a>
    </div>
</script>